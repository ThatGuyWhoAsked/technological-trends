<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Content Manager</title>
    <!-- Include the script that enables Netlify Identity on this page. -->
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <!-- Include the CMS script -->
    <script src="https://unpkg.com/netlify-cms@^2.0.0/dist/netlify-cms.js"></script>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        margin: 0;
        padding: 0;
        background: #f5f5f5;
      }
      #nc-root {
        display: flex;
        min-height: 100vh;
        flex-direction: column;
      }
      .loading {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        font-size: 1.2em;
      }
    </style>
  </head>
  <body>
    <div id="root">
      <div class="loading">Loading CMS...</div>
    </div>

    <!-- Include the config file first -->
    <script src="/admin/config.js"></script>

    <script>
      // This script will be executed after the config is loaded
      document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM fully loaded');
        
        // Check if we're in an iframe (CMS preview)
        if (window.self !== window.top) {
          console.log('Running in iframe');
          return;
        }

        console.log('Initializing CMS...');
        
        // Load Decap CMS
        const script = document.createElement('script');
        script.src = 'https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js';
        script.async = true;
        
        script.onload = function() {
          console.log('Decap CMS loaded');
          if (window.CMS && window.CMS_CONFIGURATION) {
            console.log('Initializing CMS with config:', window.CMS_CONFIGURATION);
            window.CMS.init({ config: window.CMS_CONFIGURATION });
          } else {
            console.error('CMS or config not available');
            document.getElementById('root').innerHTML = '<div class="error">Error loading CMS. Please check the console for details.</div>';
          }
        };
        
        script.onerror = function() {
          console.error('Failed to load Decap CMS');
          document.getElementById('root').innerHTML = '<div class="error">Failed to load CMS. Please check your internet connection.</div>';
        };
        
        document.head.appendChild(script);
      });
    </script>
  </body>
</html>
